#!/usr/bin/expect -f
set timeout 5
set port 18703

send "\r"
send_user "\rОДЗ: 21 вершина (выше максимума)\r"
send "\r"

spawn ../bin/server $port tcp
set server [exp_pid]

expect {
    "Сервер запущен" {}
    timeout {}
}

sleep 1

spawn ../bin/client 127.0.0.1 tcp $port

send "A B, B C, C D, D E, E F, F G, G H, H I, I J, J K, K L, L M, M N, N O, O P, P Q, Q R, R S, S T, T U, U A\r"
sleep 0.8
send "A K\r"

expect {
    "не более 20" { exit 0 }
    "максимум 20" { exit 0 }
    "больше.*20" { exit 0 }
    "Ошибка" { exit 0 }
    "Результат" { exit 1 }
    timeout { exit 0 }
}

send "exit\r"
sleep 0.3
exec kill -TERM $server
exit 0